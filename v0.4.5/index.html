<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started · MarginalLogDensities.jl</title><meta name="title" content="Getting started · MarginalLogDensities.jl"/><meta property="og:title" content="Getting started · MarginalLogDensities.jl"/><meta property="twitter:title" content="Getting started · MarginalLogDensities.jl"/><meta name="description" content="Documentation for MarginalLogDensities.jl."/><meta property="og:description" content="Documentation for MarginalLogDensities.jl."/><meta property="twitter:description" content="Documentation for MarginalLogDensities.jl."/><meta property="og:url" content="https://ElOceanografo.github.io/MarginalLogDensities.jl/"/><meta property="twitter:url" content="https://ElOceanografo.github.io/MarginalLogDensities.jl/"/><link rel="canonical" href="https://ElOceanografo.github.io/MarginalLogDensities.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>MarginalLogDensities.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Getting started</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Basic-tutorial"><span>Basic tutorial</span></a></li></ul></li><li><span class="tocitem">User guide</span><ul><li><a class="tocitem" href="theory/">Theory</a></li><li><a class="tocitem" href="sparse_ad/">Sparsity and AD</a></li><li><a class="tocitem" href="tips/">Tips for success</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="hreg/">Hierarchical regression</a></li><li><a class="tocitem" href="componentarrays/">Using ComponentArrays</a></li><li><a class="tocitem" href="turing/">Turing integration</a></li></ul></li><li><a class="tocitem" href="api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ElOceanografo/MarginalLogDensities.jl/blob/master/docs/src/index.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="MarginalLogDensities.jl"><a class="docs-heading-anchor" href="#MarginalLogDensities.jl">MarginalLogDensities.jl</a><a id="MarginalLogDensities.jl-1"></a><a class="docs-heading-anchor-permalink" href="#MarginalLogDensities.jl" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>This package implements tools for integrating out (marginalizing) parameters from log-probability functions, such as likelihoods and posteriors of statistical models. This approach is useful for fitting models that incorporate random effects or  latent variables that are important for structuring the model, but whose exact  values may not be of interest in and of themselves. In the language of regression,  these are known as &quot;random effects,&quot; and in other contexts, they may be called &quot;nuisance parameters.&quot; Whatever they are called, we hope that our log-density function can be optimized faster and/or more reliably if we focus on the parameters we are <em>actually</em> interested in, averaging the log-density over all possible values of  the ones we are not.</p><div class="admonition is-warning" id="Warning-d78706f4141bc80a"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-d78706f4141bc80a" title="Permalink"></a></header><div class="admonition-body"><p>This package is under development and should still be considered experimental at this point. Exercise appropriate caution and check your results if you&#39;re using it for  anything important. Bug reports, pull requests, and new use-cases are all welcome!</p></div></div><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>MarginalLogDensities (MLD for short) requires Julia v1.10 or greater. It is a registered Julia package, so you can install it from the REPL by typing <code>]</code> to enter package-manager mode, then running</p><pre><code class="language-julia-repl hljs">pkg&gt; add MarginalLogDensities</code></pre><h2 id="Basic-tutorial"><a class="docs-heading-anchor" href="#Basic-tutorial">Basic tutorial</a><a id="Basic-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-tutorial" title="Permalink"></a></h2><p>A basic example follows. We start out by writing a function for our target log- density. This function must have the signature <code>f(u, data)</code>, where <code>u</code> is a numeric vector of parameters and <code>data</code> contains any data, or fixed parameters, needed by the function.  The <code>data</code> argument can be anything you&#39;d like, such as a <code>Vector</code>, <code>NamedTuple</code>, <code>DataFrame</code>, or some other <code>struct</code>. (If your function does not depend on any external data, just ignore that argument in the function body)</p><div class="admonition is-info" id="Note-c71517f39ad81d7f"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-c71517f39ad81d7f" title="Permalink"></a></header><div class="admonition-body"><p>Note that the convention for this package is to write the function as a <strong>positive</strong> log-density.</p></div></div><pre><code class="language-julia hljs">using MarginalLogDensities, Distributions, LinearAlgebra

N = 3
σ = 1.5
dist = MvNormal(σ^2 * I(3))
data = (N=N, dist=dist)

function logdensity(u, data)
   return logpdf(data.dist, u) 
end</code></pre><p>We then set up a marginalized version of this function. First, we set an initial value for our parameter vector <code>u</code>, as well as a set of indices <code>iw</code> indicating the subset of <code>u</code> that we want to integrate out. </p><pre><code class="language-julia hljs">u = [1.1, -0.3, 0.1] # arbitrary initial values
iw = [1, 3]</code></pre><p>We create the marginalized version of the function by calling the <code>MarginalLogDensity</code> constructor with the original function <code>logdensity</code>, the full parameter vector <code>u</code>, the indices of the marginalized values <code>iw</code>, and the <code>data</code>. (If your function does not depend on the <code>data</code> argument, it can be omitted here.)</p><pre><code class="language-julia hljs">marginal_logdensity = MarginalLogDensity(logdensity, u, iw, data)</code></pre><p>Here, we are saying that we want to calculate <code>logdensity</code> as a function of <code>u[2]</code> only,  while integrating over all possible values of <code>u[1]</code> and <code>u[3]</code>. In the laguage of  mathematics, if we write <code>u -&gt; logdensity(u, data)</code> as <span>$f(u)$</span>, then the marginalized  function <code>v -&gt; marginal_logdensity(v, data)</code> is calculating</p><p class="math-container">\[f_m(u_2) = \iint f(u) \; du_1 du_3.\]</p><p>After defining <code>marginal_logdensity</code>, you can call it just like the original function, with the difference that you only need to supply <code>v</code>, the subset of parameters you&#39;re  interested in, rather than the entire set <code>u</code>. </p><pre><code class="language-julia hljs">initial_v = [1.0] # another arbitrary starting value
length(initial_v) == N - length(iw) # true
marginal_logdensity(initial_v, data)
# -1.5466258635350596</code></pre><p>Compare this value to the analytic marginal density, i.e. the log-probability of <span>$N(0, 1.5)$</span> at 1.0:</p><pre><code class="language-julia hljs">logpdf(Normal(0, 1.5), 1.0)
# -1.5466258635350594</code></pre><p>You also can re-run the same <code>MarginalLogDensity</code> with different <code>data</code> if you want -  though if the sparsity of your problem depends on the <code>data</code> in shome way, this may cause errors. See the section on sparsity for more information.</p><p>The point of doing all this was to find an optimal set of parameters <code>v</code> for your data. MLD includes an interface to Optimization.jl that  works directly with a <code>MarginalLogDensity</code> object, making  optimization easy. The simplest way is to construct an <code>OptimizationProblem</code> directly from the <code>MarginalLogDensity</code> and <code>solve</code> it:</p><pre><code class="language-julia hljs">using Optimization, OptimizationOptimJL

opt_problem = OptimizationProblem(marginal_logdensity, v0)
opt_solution = solve(opt_problem, NelderMead())</code></pre><p>If you want more control over options, for instance setting an AD backend, you can construct an <code>OptimizationFunction</code> explicitly:</p><pre><code class="language-julia hljs">opt_function = OptimizationFunction(marginal_logdensity, AutoFiniteDiff())
opt_problem = OptimizationProblem(opt_function, v0)
opt_solution = solve(opt_problem, LBFGS())</code></pre><div class="admonition is-info" id="Note-f1716f88e388cd1e"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-f1716f88e388cd1e" title="Permalink"></a></header><div class="admonition-body"><p>At present we can&#39;t differentiate through the Laplace approximation, so outer  optimizations like this need to either use a gradient-free solver (like <code>NelderMead()</code>), or a finite-difference backend (like <code>AutoFiniteDiff()</code>). We hope to remove this  limitation in the future.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="theory/">Theory »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 21 October 2025 01:23">Tuesday 21 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
